---
title: "Introduction to ggDoubleHeat"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{introduction}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  message = FALSE,
  warning = FALSE,
  comment = "#>"
)
```

The *ggDoubleHeat* package is a ggplot2 extension. *ggDoubleHeat* plots are reformed heat maps that compare two sets of values with shared data attributes. They can be quite useful for visualizing data from two different sources with at least four dimensions, and can be generated by using *ggplot2* with ease. 

# How to use the package?

## Meet the `geom_heat_*()` family

All functions in ggDoubleHeat are named `geom_heat_*()` for consistency. Unlike a typical `geom_`function in ggplot2, all data variables do not need `aes()` when using `geom_heat_*()`, allowing plots having different color rendering internally. 

Before generating any plot, it is necessary to introduce one of the built-in data set in the package `pitts_tg`. This data set includes Google and Twitter COVID-related searches and tweets (included in the 9 categories) incidence rate respectively in the Pittsburgh Metropolitan Statistical Area (MSA) in a 30-week period. For complete data introduction, just type `?pitts_tg` at the console.

Here is the structure of the data set. 


```{r setup}
library(ggplot2)
library(ggDoubleHeat)
pitts_tg

```

Only `week`, `category`, `Twitter`, and `Google` are the four columns we need.

* `geom_heat_grid()`

```{r}
library(dplyr)
pitts_tg %>%
  ggplot(aes(week, category)) +
  geom_heat_grid(outside = Google, inside = Twitter)
```

If we think the colors on the above heatgrid get washed out, `trans = "sqrt"` is a good option to tune the scale.

```{r}
pitts_tg %>%
  ggplot(aes(week, category)) +
  geom_heat_grid(outside = Google, inside = Twitter, trans = "sqrt")
```

`trans = "sqrt"` here is equivalent to `scale_x/y_sqrt()` but on `fill`.

If we want to decrease the area of the inside, `r` should be increased.

```{r}
pitts_tg %>%
  ggplot(aes(week, category)) +
  geom_heat_grid(outside = Google, inside = Twitter, r = 5)
```

The larger `r` is, the samller the inside turns out to be. Note: `r` has to be greater than 2. 


`ggplot2` by default gives some paddings (margins) to the plot. There is a nifty function `remove_padding()` built inside of the package to help make the plot full.

```{r}
pitts_tg %>%
  ggplot(aes(week, category)) +
  geom_heat_grid(outside = Google, inside = Twitter) +
  remove_padding()
```

* `geom_heat_circle()`

By replacing `_grid` to `_circle`, 

```{r}
pitts_tg %>%
  ggplot(aes(week, category)) +
  geom_heat_circle(outside = Google, inside = Twitter)
```

* `geom_heat_tri()`

```{r}
pitts_tg %>%
  ggplot(aes(week, category)) +
  geom_heat_tri(lower = Google, upper = Twitter)
```

`geom_heat_tri` has slight different arguments than the previous two `geom_heat_*` functions. Instead of `outside` and `inside`, it has `lower` and `upper`. Also, `r` does not exist for this function. Users can figure out why this is the case. 

Now we can tidy the heatgrid up:

```{r}
pitts_tg %>%
  ggplot(aes(week, category)) +
  geom_heat_grid(outside = Google, inside = Twitter, trans = "sqrt",
                 labels = scales::percent_format(scale = 1)) +
  theme_heat() +
  remove_padding() +
  labs(title = "Pittsburgh Google & Twitter Incidence Rate")
```

`theme_heat()` is a theme provided by the package.


# When to use the package?

Without ggDoubleHeat, One of the ways to visualize `pitts_tg` in a heatmap-like way is:

```{r}
pitts_tg %>%
  pivot_longer(cols = c(Twitter:Google), names_to = "source", values_to = "incidence_rate") %>%
  ggplot(aes(week, category, fill = incidence_rate)) +
  geom_tile() +
  facet_wrap(~source)
```


When looking at the faceted plot, we immediately recognize it is not easy to compare Google and Twitter incidence rate for a specific week and a specific category, as they are far apart from each other. `geom_heat_grid()` in essence combines the faceted plots into one integral plot, while making it much easier to compare the difference among Google/Twitter incidence rates. 


So far, we have only visualized the incidence rates in Pittsburgh. Since we mentioned faceting above, it is time to make a heatgrid with multiple states involved.

`state_tg` has the exact same data structure as `pitts_tg`. For more information, just type `?state_tg` at the console. 





